/*!
* App Studio Core shared by app and the studio
* Copyright 2017-2024 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function gt(){if(n.busy())setTimeout(gt,100);else{var u=t.studio.state(),r=u.trigger;r&&(r==="reload"?t.studio.state(null):i?f("show"):c())}}function h(n){parent.postMessage(n,location.href)}function a(n){b&&b[0].contentWindow.postMessage(n,location.href)}function c(t){if(!n.busy())if(t||(t={inspect:!1}),i)$(".studio-btn-inspect").attr({"data-studio-action":"inspect-end","data-title":"End Inspection"}).find("i").text("arrow_selector_tool"),e.addClass("studio-inspecting"),k=!0;else{t.event&&(ft=t);$(document.activeElement).trigger("blur");n.tooltip(!1);n.notify(!1);try{window.location.hash&&(it=window.history.state)}catch(r){}n.busy(!0);t.inspect&&$(".studio-btn-inspect i").text("arrow_selector_tool");b=$(`<iframe class="studio-frame" src="${__baseUrl}_appstudio?_showNavigation=false&inspect=${t.inspect?"true":"false"}"></iframe>`).css("left",-1e4).appendTo(e).trigger("focus")}}function y(){if(i&&!n.busy()&&!f(":active")){var t=$.touch.navigate.history.activeIndex+1;t>2?(n.whenPageShown(y),window.history.go(2-t)):h({method:"hide"})}}function ai(n){return n.name==="Responsive"&&o.width===r.physicalWidth-112&&o.height===r.physicalHeight-112||o.width===n.width&&o.height===n.height||o.width===n.height&&o.height===n.width}function ot(){if($(".app-bar-notify").removeData("notify"),i)f(":active")?bt():(y(),h({method:"exit"}));else{if(r.isVirtual){var u=n.device();u&&t.userVar("lastVirtualDevice",u);t.storage.set(window.location.host+"_VirtualDeviceHint","off");t.userVar("studioOnStart?",!1);tt({name:"Responsive"});n.screen("resize");ni()}vt()}}function ni(i){i?t.storage.get(window.location.host+"_VirtualDeviceHint")!=="off"&&setTimeout(()=>{n.notify({text:"App Studio mode was started automatically. Use the studio controls to modify this application. You can exit to the app at any time.",duration:"long",buttonText:"Disable",buttonEvent:"studioonstartdisabled.app"})},1e3):n.notify({text:'<div>Press Ctrl+Shift+D or chose the "Design" option\nin the "More" menu to start the App Studio.<\/div>',html:!0,duration:"long",buttonText:"Design",buttonEvent:"studioactioninspectstart.app"})}function ti(){var n=$(parent.window.document).find(".ui-page-active .app-wrapper");kt=n[0].scrollHeight-n.height()}function vi(n){var t=n.keyCode||n.which;if(!n.isDefaultPrevented()&&t===27&&$(".ui-page-active#studio").length)return v.is(":visible")?rt():setTimeout(y),!1}function p(){return Promise.all([t.studio.getScript("~/js/studio/tools.js"),t.studio.getScript("~/css/appstudio-icons.css")]).catch(t=>{n.notify(at(t));throw t;})}function rt(){v&&v.hide()}function yi(n){window.open("https://codeontime.com/roadmap/v9?topic="+encodeURIComponent(n.path))}function pi(t){var r,i,u;return n.notify(!1),r=t.context.target,r?._links&&(i=r._links[t.eventName],u=t.patch,i||t.eventName!=="edit"||(i=r._links.replace,i&&(u=new FormData,u.append("value",new Blob([JSON.stringify(r)],{type:"application/json"})))),i)?g({url:i,body:u}).catch(w):void 0}function wi(t,i){var e=[],r,o,u;for(o in i)u=i[o],r=ct(r,u,t),r=="none"&&u.alterApp&&e.push(u.alterApp);e.length&&(t._context=n.treeView.data(),h({method:"alterUI",scripts:e,context:t}),delete t._context);r!="none"&&f("trigger",r)}function ct(n,i,r){var n,u;return typeof i=="object"&&(u=i,i=u.alterApp?"none":u.trigger!=null?t.eval(u.trigger,r||{}):"reload"),i?i==="none"?n||(n=i):i==="generate"?n!=="refresh"&&n!=="sync"&&(n=i):i==="reload"?n!=="generate"&&n!=="refresh"&&n!=="sync"&&(n=i):i==="refresh"?n!=="sync"&&(n=i):n=i==="sync"?i:"none":n="reload",n}function s(i){var s=i.target||e,r=i.action,o=$.Event("studioaction"+r.replace(/\-/g,"")+".app"),u;if(f(":log"))return n.notify("App Studio is busy. Please wait..."),!1;if(f(":active")&&r.match(/^(exit|rotate|device|publish|inspect\-(start|end))$/))return bt(r),!1;rt();s.trigger(o);o.isDefaultPrevented()||(u=d[r],u?(d._last=r,n.notify({text:u.text+` is not supported in the release ${__settings.version}. The roadmap provides information about the alternative and the expected avaialability of this feature in the App Studio.`,duration:"long",buttonText:"Learn",buttonEvent:"studiofeature.app"})):r==="help"?window.open("https://codeontime.com/roadmap/v9","_blank"):p().then(()=>{var i=t.studio.tools[r];i?i.run():n.notify(`Tool "${r}" is not supported."`)}).catch(()=>{}))}function lt(t){let i=d[t];if(i&&!i._notified&&(i._notified=!0,!$(".studio-selector:visible").length)){var r=__settings.version.split(/\./g);r.splice(r.length-1,1,"0");n.notify({text:i.text+` is not fully implemented in the release ${r.join(".")}. The roadmap provides information about the alternative and the expected avaialability of this feature in the App Studio.`,duration:"long",buttonText:"Learn",buttonEvent:"studiofeature.app"})}}function w(t){n.notify(typeof t=="string"?t:at(t))}function ii(t){f("error");n.notify({text:"The app is not operational. Review the log for errors."+(t?"Error: "+t.message:""),duration:"long"})}function st(n){var t=$app.studio.tools.cache[n];return t?Promise.resolve(t):g({url:n,cache:!0}).then(t=>($app.studio.tools.cache[n]=t,Promise.resolve(t)))}function bi(n){if(!n)return Promise.resolve(null);var t=$app.studio.tools.cache[n];return t?Promise.resolve(t):g({url:`/v2/studio/objects/${n}/definition`,cache:!0}).then(t=>{for(var i in t)t[i].scope=n;return $app.studio.tools.cache[n]=t,Promise.resolve(t)})}function ri(n){var i=n.hypermedia,f=n.context,r,e,u;if(!i&&!f)return Promise.resolve(null);if(typeof i=="object"&&i.hypermedia&&(r=i,i=i.hypermedia),i=f?i:`projects >> ${t.id} >> ${i}`,e={hypermedia:i,query:n.query,context:f,cache:!0},r)for(u in r)u.match(/^hypermedia$/)||(e[u]=r[u]);return g(e).then(n=>Array.isArray(n)?Promise.resolve({collection:n}):Promise.resolve(n))}function nt(i){var r=i.result.sessionId;r&&t.restful({baseUrl:n.studio(),hypermedia:`projects >> ${t.id} >> session >>`,body:{parameters:{sessionId:r}},token:t.studio.token}).then(t=>{var r=t.result.log,i,e,o,s;r.length&&(i=f(),e=-1,r.every((n,t)=>(n.match(/\.(\w+)?Exception/)&&!i.data("exception")&&(e=t),e===-1)),e!==-1&&(o=r.slice(0,e),o.length&&u().text(o.join("\n")).appendTo(i),u().attr("style","background-color:red;").text(r[e]).appendTo(i),r.splice(0,e+1),i.data("exception",!0)),r.length&&u().text(r.join("\n")).appendTo(i),i.scrollTop(i[0].scrollHeight-i.height()));t.result.done?(s=i.data("exception"),s?n.notify({text:"An exception was detected. Please review the log.",duration:6e4}):ui()):setTimeout(nt,t.result.timeout,t)}).catch(w)}function ui(){var t="The app is about to reload...";f(":log")&&(t="The project has been regenerated. "+t);n.notify({text:t,duration:"long"});fetch("_appstudio").then(n=>n.text()).then(n=>{function r(){if(!r._done){r._done=!0;var i=n.match(/<code><pre>([\s\S]+)?<\/pre><\/code>/);i&&$(i[0]).appendTo(t)}}var t=f(),u,i;if(n.match(/var __settings=\{/))h({method:"reload"});else{for($("<div><br/><\/div>").appendTo(t),u=/<b>(.+):\s*<\/b>(.+)\r*\n/g,i=u.exec(n);i;)$("<div>"+i[0].replace(/<br>/g,"")+"<\/div>").appendTo(t),i[2]&&!i[2].replace(/<br>/g,"")&&r(),i=u.exec(n);r();t.scrollTop(t[0].scrollHeight-t.height());ii()}}).catch(ii)}function at(i){var u=i||{message:"Unable to execute"},r=i.errors,f=[];return r&&r.forEach(n=>f.push(n.message)),{text:r?f.join("\n"):t.studio.tools?u.message+(i.stack?`
Stack:${i.stack}`:""):`Start "${n.appName()}" from the App Studio.
Error: ${u.message}.`,duration:3e4}}function vt(){i||e.toggleClass("studio-hidden",r.width===r.physicalWidth)}function ki(i){var f=i?._links?.self?.href,r,u,e;if(f&&(r=f.match(/\/controllers\/(?<controller>.+?)\/views\/(?<view>.+?)\/categories\/(?<category>.+?)\/data-fields\/(?<fieldName>.+?)(\/|$)/),r||(r=f.match(/\/controllers\/(?<controller>.+?)\/views\/(?<view>.+?)\/data-fields\/(?<fieldName>.+?)(\/|$)/)),r||(r=f.match(/\/controllers\/(?<controller>.+?)\/views\/(?<view>.+?)\/categories\/(?<category>.+?)(\/|$)/)),r||(r=f.match(/\/controllers\/(?<controller>.+?)\/views\/(?<view>.+?)(\/|$)/)),r||(r=f.match(/\/controllers\/(?<controller>.+?)\/fields\/(?<field>.+?)(\/|$)/)),r||(r=f.match(/\/controllers\/(?<controller>.+?)\/action-groups\/(?<actionGroup>.+?)\/actions\/(?<action>.+?)(\/|$)/)),r||(r=f.match(/\/controllers\/(?<controller>.+?)\/action-groups\/(?<actionGroup>.+?)(\/|$)/))),r&&(r=r.groups,r.controller&&(e=n.dataView(),e&&e._controller==r.controller&&(e._viewId==r.view?r.fieldName?u=fi(r.fieldName):r.category?u=n.activePage(`[data-layout="form"] [data-category="${r.category}"]`):r.view&&(u=n.activePage()):r.field?u=fi(r.field):r.action?u=n.activePage(`[data-action-path="${r.actionGroup}/${r.action}"]`):r.actionGroup&&(u=n.activePage(`[data-action-path="${r.actionGroup}"]`),u.length||e.get_viewType()=="Form"&&(e._actionGroups.forEach(t=>{t.Id==r.actionGroup&&t.Scope==="Form"&&(u=n.activePage(`.app-bar-buttons`))}),u.length||(u=n.activePage(`[data-field="${r.actionGroup}"][data-control="field"]`))))))),u?.length&&u.is(":visible")){var s=t.clientRect(n.scrollable()),o=t.clientRect(u),h=s.top+20,c=s.bottom-20;(o.top>=c&&o.bottom>=c||o.top<=h&&o.bottom<=h)&&(u[0].scrollIntoView({block:"nearest",behavior:"instant"}),o=t.clientRect(u));setTimeout(()=>$(".app-bar-heading").hide(),200);a({method:"marker",bounds:o})}else a({method:"marker",bounds:!1})}function fi(t){var r=null,u=n.dataView(),i=u.findField(t);return i&&(u?._view?.Type=="Form"?(i=u._allFields[i.OriginalIndex],r=n.activePage(`[data-layout="form"] [data-field="${i.Name}"][data-control="${i.Type=="DataView"?"dataview":"field"}"]`)):(i=u._allFields[i.AliasIndex],r=n.activePage(`.dv-item .app-selected .app-field-${i.Name}:visible`).first(),r.length||(r=n.activePage(`.dv-item .app-field-${i.Name}:visible`).first()))),r}function di(i){function r(n){n!=null&&(n===""&&(n="(blank)"),u.length&&u.push(" / "),u.push(t.htmlEncode(n)))}var u=[];r(i.controller,"Controller");i.type==="page"?r(i.page,"Page"):i.action?(r(i.actionGroup,"Action Group"),r(i.action,"Action")):(r(i.view,"View"),r(i.category,"Category"),r(i.fieldName,"Data Field"));i.property&&r(t.prettyText(i.property),"Property");n.notify(t.prettyText(i.type,!0)+": "+u.join(""))}function yt(f){var o,h,a,c,l,s;(i||r.isVirtual||t.userVar("studioOnStart?")===!1||(tt({name:"Responsive",width:"auto",height:"auto"}),n.screen("resize")),$(".studio-btn-inspect").length)||(f&&(e.addClass("studio-controls-hidden"),r.isVirtual&&!i&&ni(!0)),vt(),o=u("studio-toolbar studio-toolbar-top").appendTo(e),h=i&&k,n.icon("material-icon-"+(h?"arrow-selector-tool":"point_scan"),u("studio-btn studio-btn-inspect").attr({"data-studio-action":h?"inspect-end":"inspect-start",title:h?"End Inspection":"Inspect"}).appendTo(o)),n.icon("material-icon-settings",u("studio-btn").attr("data-studio-action","settings").attr("title","Settings").appendTo(o)),n.icon("material-icon-edit-note",u("studio-btn").attr("data-studio-action","develop").attr("title","Edit Project Code").appendTo(o)),n.icon("material-icon-folder-code",u("studio-btn").attr("data-studio-action","open").attr("title","Show Source Code").appendTo(o)),n.icon("material-icon-sync",u("studio-btn").attr("data-studio-action","sync").attr("title","Sync Design").appendTo(o)),n.icon("material-icon-publish",u("studio-btn").attr("data-studio-action","publish").attr("title","Publish").appendTo(o)),n.icon("material-icon-help",u("studio-btn").attr("data-studio-action","help").attr("title","Help").appendTo(o)),n.icon("material-icon-exit-to-app",u("studio-btn").attr("data-studio-action","exit").attr("title","Exit to App").appendTo(o)),n.icon("material-icon-history",u("studio-btn").attr("data-studio-action","startover").attr("title","Reset Session").appendTo(o)),n.icon("material-icon-screen-rotation-alt",u("studio-btn").attr("data-studio-action","rotate").attr("title","Rotate").appendTo(o)),a=u("studio-toolbar studio-toolbar-bottom").appendTo(e),c=u("studio-btn").attr("data-studio-action","device").attr("title","Device").attr("data-tooltip-location","above").attr("data-tooltip-align","left").appendTo(a),n.icon("material-icon-devices",c),u("studio-btn-label").appendTo(c).text("iPad 1024 x 768"),l=u("studio-toolbar studio-toolbar-left").appendTo(e),n.icon("material-icon-apps",u("studio-btn").attr("data-studio-action","apps").attr("title","Apps").appendTo(l)),n.icon("material-icon-widgets",u("studio-btn").attr("data-studio-action","widgets").attr("title","Widgets").attr("data-tooltip-location","above").attr("data-tooltip-align","left").appendTo(l)),s=u("studio-toolbar studio-toolbar-right").appendTo(e),n.icon("material-icon-more-"+(t.agent.android?"vert":"horiz"),u("studio-btn").attr("data-studio-action","more").attr("title","More").appendTo(s)),n.icon("material-icon-table-view",u("studio-btn").attr("data-studio-action","models").attr("title","Models").attr("data-tooltip-location","left").appendTo(s)),n.icon("material-icon-menu-book",u("studio-btn").attr("data-studio-action","pages").attr("title","Pages").attr("data-tooltip-location","left").appendTo(s)),n.icon("material-icon-account-tree",u("studio-btn").attr("data-studio-action","explore").attr("title","Controllers").attr("data-tooltip-location","left").appendTo(s)),i||(wt(),pt()),ei(),f&&setTimeout(()=>e.removeClass("studio-controls-hidden"),32))}function gi(n){tt(n.device,n.exitStudio)}function tt(t,u){if(t=JSON.parse(JSON.stringify(t)),i)o=t,t.autoRotate=!0,h({method:"changeDevice",device:t,exitStudio:u});else{si=t;var f=t.width,e=t.height;f==null?r.isVirtual=!1:f==="auto"?r.isVirtual=!0:(r.isVirtual=!0,r.width=f,r.height=e,t.width=r.width,t.height=r.height);t.autoRotate&&(delete t.autoRotate,e!=="auto"&&e>r.physicalHeight-112&&t.height>f&&(t.width=r.width=e,t.height=r.height=f));n.device(t);r.deviceWidth=r.deviceHeight=null;n.screen("resize");pt(t)}}function pt(t){t||(t=n.device());var i=t.name!=="Responsive";$('[data-studio-action="rotate"]').toggleClass("studio-btn-hidden",!i);a({method:"studioToolsChanged",tools:{rotate:i}})}function nr(){var i=n.device(),t=dt.find(n=>n.name===i.name);return(t&&t.width==="auto"||!i.name)&&(t={name:"Responsive",width:r.physicalWidth-112,height:r.physicalHeight-112}),t||i}function wt(){if(!i){var f=$('[data-studio-action="device"] .studio-btn-label'),t=n.device(),e=t.width==="auto"||t.width===r.width&&t.height==r.height?t.name+" ":"",u=`${e}${r.width} x ${r.height}`;f.html(u);a({method:"virtualDeviceChanged",options:{text:u,screen:r}})}}function bt(i){var u=t.studio.state(),r=u?.trigger||"reload";n.notify({text:(i?"This tool is not available in the changed application.":"Application has changed. Use the available studio tools to make other changes.")+` Click anywhere in the app boundaries to ${r}.`,duration:"long",buttonText:r,buttonEvent:"execstudiotrigger.app"})}function ei(){i&&$(".studio-app-shield").length&&["inspect-start","inspect-end","exit","rotate","publish","device"].forEach(n=>$(`[data-studio-action="${n}"]`).addClass("studio-disabled"))}function f(r,s){var h,c;if(s==null&&(s={}),h=s.shield||$(".studio-app-shield"),r){if(!i&&!r.match(/^\:/)){a({method:"shield",args:{method:r,options:s}});return}switch(r){case"show":h.length||(h=u("studio-app-shield").appendTo(e),f("reposition",{shield:h}));ei();break;case"reposition":h.css({left:o.left,top:o.top,right:o.right,bottom:o.bottom});break;case"trigger":h.length||(h=f("show"));c=t.studio.state();c.trigger=ct(c.trigger,s);t.studio.state(c);h.removeClass("studio-log").removeData("exception").empty();break;case"log":h.length||(h=f("show").attr("data-context-menu",!0));h.addClass("studio-log").removeData("exception").empty().removeClass("studio-error");n.notify(!1);break;case":log":return h.is(".studio-log:not(.studio-error)")&&!h.data("exception");case":active":return!!h.length;default:if(r.match(/^\:/))return h.is(".studio-"+r.substring(1));h.addClass("studio-"+r)}}return h}function tr(){var n=t.studio.state();switch(n.trigger){case"reload":t.studio.state(null);ui();break;case"generate":t.studio.state(null);f("log");p().then(()=>t.studio.tools.generate.run()).then(nt).catch(ut);break;case"refresh":t.studio.state(null);f("log");p().then(()=>t.studio.tools.sync.run({metadata:!1})).then(nt).catch(ut);break;case"sync":t.studio.state(null);f("log");p().then(()=>t.studio.tools.sync.run({metadata:!0})).then(nt).catch(ut)}}function ut(n){f().remove();w(n)}function g(i){var r,u;return i.baseUrl=n.studio(),i.token=t.studio.token,r=i.url,r&&typeof r!="string"&&r.method!=="GET"&&(u=r.href.split(/\//g),u.length>5&&(i.cacheTrimDepth=u.length-3)),t.restful(i)}function oi(n){var r=__settings.appName.replace(/\W/g,"_")+"_",i=[];for(var t in n)t.indexOf(r)!==0||t.match(/(\.|_)studio(\.|_)/)||i.push(t);i.forEach(t=>delete n[t])}function ht(n){return v||(v=li("studio-selector").appendTo("#studio").hide()),n=="show"&&(v.hide().addClass("app-animated"),setTimeout(()=>v.show().removeClass("app-animated"))),v}var t=$app,n=t.touch,b,v,e=$("body"),i,k,it,kt,dt=[{name:"Responsive",width:"auto",height:"auto"},{name:"iPhone SE ",width:375,height:667},{name:"iPhone XR",width:414,height:896},{name:"iPhone 12 Pro",width:390,height:844},{name:"Pixel 5",width:393,height:851},{name:"Pixel 7",width:412,height:783},{name:"Pixel 7 Pro",width:412,height:892},{name:"Pixel 8 Pro",width:448,height:998},{name:"Samsung Galaxy S8+",width:360,height:740},{name:"Samsung Galaxy S20 Ultra",width:412,height:915},{name:"iPad Air",width:820,height:1180},{name:"iPad Mini",width:768,height:1024},{name:"iPad Pro",width:1024,height:1366},{name:"Surface Pro 7",width:912,height:1368},{name:"Surface Duo",width:540,height:720},{name:"Galaxy Fold",width:280,height:653},{name:"Samsung Galaxy A51/71",width:412,height:914}],si,o={},r=n.screen(),ft,et,hi={studio:!0,inspect:!0,text:"Design",desc:"App Studio",icon:"material-icon-build",shortcut:"Ctrl+Shift+D",toolbar:!1,sidebar:!1,callback:()=>c({inspect:!0})},ci={studio:!0,inspect:!0,text:"Exit to App",desc:"App Studio",icon:"material-icon-exit-to-app",shortcut:"Ctrl+Shift+D",toolbar:!1,sidebar:!1,callback:ot},d={apps:{text:"Apps Directory",url:"id.usg03cqgj9ij"},settings:{text:"Project Settings editor",url:"id.ryz0l8ywajq0"},models:{text:"Model Builder",url:"id.tnjobt7r90rf"},pages:{text:"Navigation Menu editor",url:"id.tnjobt7r90rf"},restful:{text:"RESTful API Mode",url:"id.ko25gif05jss"},widgets:{text:"Widgets menu",url:"id.tbrssg6y5jeb"},explore:{text:"Project Explorer",url:"id.6vqwqh1rfqxa"},publish:{text:"Publishing",url:"id.5f7dfyfh4a7x"}},l=t.html,ir=l.tag,rr=l.div,ur=l.span,fr=l.$tag,er=l.$p,u=l.$div,li=l.$span,or=l.$a,sr=l.$i,hr=l.$li,cr=l.$ul;t.studio={_config:{},start:function(){__settings.appStudio&&(t.id=__settings.appStudio.self.id);i?h({method:"enableVirtualDevice"}):yt(!0);gt()},define:function(n,i,r){var u=t.studio._config[n],f;if(u||(u=t.studio._config[n]={}),arguments.length===2)return u[i];switch(i){case"node":case"inspector":u[i]||(u[i]=[]);Array.isArray(r)?u[i]=u[i].concat(r):u[i].push(r);break;default:if(u[i]||(u[i]={}),typeof r=="object")for(f in r)u[i][f]=r;else u[i]=r}return u},toSelector:function(i,r){var v,u={type:r.type},a=r.collect,h=["type"],o,f,c,e,s,y,l;for(o in a)h.push(o);for(o in a)f=a[o],typeof f=="string"&&(f.match(/^\$/)?u[o]=f:(f=f.split(/\//),c=i,f.length===2?(c=i.closest(f[0]),u[o]=f[1].match(/^@/)?c.attr(f[1].substring(1)):c.find(f[1]).text()):u[o]=f[0].match(/^@/)?c.attr(f[0].substring(1)):c.closest(f[0]).text()));"dataView"in u&&(e=u.dataView,e==="$dataView"?(s=i.closest(".app-echo").attr("data-for"),s||(s=i.closest(".ui-page").attr("id")),s==="Main"&&(s=i.closest(".app-echo").attr("data-for")),e=t.find(s),e&&e._controller&&e._viewId||(s=null,e=null),u.dataView=s):e=t.find(u.dataView),e&&(h.splice(h.indexOf("dataView")+1,0,"controller","view"),u.controller=e._controller,u.view=e._viewId,y=n.pageInfo(e),(y&&y.home||i.closest("#Main.ui-page").length)&&(h.splice(h.indexOf("dataView"),0,"page"),l=location.pathname.split(/\//g),u.page=l[l.length-1])));"page"in u&&u.page==="$page"&&(l=location.pathname.split(/\//g),u.page=l[l.length-1]);for(o in a)f=a[o],typeof f=="function"&&(u[o]=f.call(u,i));return v={},r.property&&(u.property=r.property,h.push("property")),h.forEach(function(n){v[n]=u[n]}),v},config:function(n){var i,t;for(var r in this._config)if(t=this._config[r],t.when&&t.when()){i=t[n];break}return i},inspect:function(i,r){var u,s,f,e,h,c,o;b.css("left",-1e4);u=$(document.elementFromPoint(i,r));h=t.studio.config("inspector");u.is(".app-wrapper")&&u.closest(".app-page-modal").length&&(o=u.closest(".ui-page").find(".app-page-header:first"),o.length&&(o.css("z-index",parseFloat(u.css("z-index"))+1).find("i").css("z-index",-1),u=$(document.elementFromPoint(i,r)),o.css("z-index","").find("i").css("z-index","")));h?(b.css("left",""),h.every(function(n){var i,o,r;try{if(i=u.closest(n.test),i.length&&(!n.skip||!u.closest(n.skip).length)&&(!n.keep||i.closest(n.keep).length)&&(u=i,s=n,e=n.navigate,f=t.studio.toSelector(u,n),c=u,n.require))for(o in n.require)if(r=n.require[o],(typeof r=="function"&&r.call(f,u)||r)&&f[o]==null){s=null;f=null;e=null;c=null;break}}catch(h){console.log(`${h.message} in "${n.test}"`)}return!s}),typeof e=="function"&&(e=e.call(f,c)),this.explore({elem:u,selector:f,navigate:e})):n.notify("Inspector configuration is not available.")},explore:function(n){var i=n.elem,r=t.clientRect(i);a({method:"explore",selector:n.selector,bounds:r,navigate:t.eval(n.navigate,n.selector)})},menu:function(){return[{title:"Home",url:"/pages/home",description:"Application home page",selected:!0,cssClass:"Wide"}]},getScript:function(i,r){return typeof i!="string"&&(r=i,i=r.url),r||(r={}),i.match(/^~\//)&&(i=n.studio()+"/"+i.substring(2)),et?(r.manifest=et,t.getScript(i,r)):new Promise((u,f)=>{fetch(n.studio()+"/manifest.json",{cache:"no-store"}).then(n=>n.text()).then(e=>{et=JSON.parse(e);var o=n.studio();et.offline_resources.forEach(n=>{n.src=o+"/"+n.src});t.studio.getScript(i,r).then(()=>{u()}).catch(n=>{f(n)})}).catch(n=>{f(n)})})}};$(document).on("vclick",".studio #studio .ui-content",function(){n.notify(!1);k?h({method:"inspect",at:n.lastTouch()}):y()}).one("start.app",function(){if($("body.studio").length){i=!0;k=n.startUrl().match(/inspect=true/);ht();h({method:"started"});k&&(e.addClass("studio-inspecting"),n.notify({text:"Click or tap anywhere in the app to inspect. Press 'Esc' to end the inspection mode.",duration:"long"}));$(document).on("keydown",vi);t.studio.start()}}).one("pagereadycomplete.app",function(){var t,r,n;if(i){yt(!i);t=$(parent.window.document).find(".ui-page-active .app-wrapper");r=t.scrollTop();$(".ui-page-active .app-vscrollbar").css("display","none");ti();n=$(".ui-page-active .app-wrapper");u("studio-scroller").css({height:kt+n.height()}).appendTo(n);n.scrollTop(r).data("scrollTop",r).on("scroll",function(){var i=n.scrollTop();i!==n.data("scrollTop")&&(rt(),t.scrollTop(i),n.data("scrollTop",i))})}}).on("pagereadycomplete.app",()=>{i&&!location.hash&&f(":active")&&bt()}).on("resized.app",function(){i&&ti();wt()}).on("context.app",function(n){if(i){if(!location.hash){var t=i&&k;n.context.push({studio:!0,text:"Apps",icon:"material-icon-apps",context:{action:"apps"},callback:s},{studio:!0},{studio:!0,text:t?"End Inspection":"Inspect",icon:t?"material-icon-arrow-selector-tool":"material-icon-point-scan",context:{action:t?"inspect-end":"inspect-start"},callback:s},{studio:!0,text:"Settings",icon:"material-icon-settings",context:{action:"settings"},callback:s},{studio:!0},{studio:!0,text:"Edit Project Code",icon:"material-icon-edit-note",context:{action:"develop"},callback:s},{studio:!0,text:"Show Source Code",icon:"material-icon-folder-code",context:{action:"open"},callback:s},{studio:!0,text:"Sync Design",icon:"material-icon-sync",context:{action:"sync"},callback:s},{studio:!0,text:"Publish",icon:"material-icon-publish",context:{action:"publish"},callback:s},{studio:!0},{studio:!0,text:"Pages",icon:"material-icon-menu-book",context:{action:"pages"},callback:s},{studio:!0,text:"Models",icon:"material-icon-table-view",context:{action:"models"},callback:s},{studio:!0,text:"Controllers",icon:"material-icon-account-tree",context:{action:"explore"},callback:s});n.context.push({studio:!0},{studio:!0,text:"Form Template",context:{action:"form-template"},icon:"material-icon-screenshot",callback:s},{studio:!0});$('[data-studio-action="rotate"]').is(".studio-btn-hidden")||n.context.push({studio:!0,text:"Rotate",icon:"material-icon-screen-rotation-alt",context:{action:"rotate"},callback:s});n.context.push({studio:!0,text:"Reset Session",context:{action:"startover"},icon:"material-icon-history",callback:s});n.context.push(ci)}}else r.isVirtual||n.context.push({},hi)}).on("vclick",".studio-app-shield",()=>{if(!f(":log"))return tr(),!1}).on("execstudiotrigger.app",()=>{f().trigger("vclick")}).on("vclick","[data-studio-action]",n=>{var t=$(n.target).closest("[data-studio-action]");return t.addClass("app-active"),setTimeout(()=>{t.removeClass("app-active")},96),setTimeout(s,64,{target:t,action:t.attr("data-studio-action")}),!1}).on("studioactioninspectend.app",()=>(y(),!1)).on("studioactioninspectstart.app",()=>(c({inspect:!0}),!1)).on("studioactionexit.app",()=>(ot(),!1)).on("studioactionmore.app",()=>{if(i){if(n.showContextMenu(),!k)$(document).one("panelclosed.app",n=>{n.canceled&&y()})}else c({event:{type:"studioactionmore.app"}});return!1}).on("studioactionsettings.app",()=>(i?p().then(()=>{$app.touch.propGrid("show",{instance:"studio.settings",text:"Settings",icon:"material-icon-settings",nodes:st(`/v2/studio/hierarchies/settings/definition`),helpUrl:"https://codeontime.com/roadmap/v9",location:"left"}),lt("settings")}).catch(n=>w(n)):c({event:{type:"studioactionsettings.app"}}),!1)).on("studioactionexplore.app",()=>(i?p().then(()=>{$app.touch.propGrid("show",{instance:"studio.explore",text:"Controllers",icon:"material-icon-account-tree",nodes:st(`/v2/studio/hierarchies/controllers/definition`),helpUrl:"https://codeontime.com/roadmap/v9",location:"right",dragDrop:"appstudio"})}).catch(n=>w(n)):c({event:{type:"studioactionexplore.app"}}),!1)).on("studioactionmodels.app",()=>(i?p().then(()=>{$app.touch.propGrid("show",{instance:"studio.models",text:"Models",icon:"material-icon-table-view",nodes:st(`/v2/studio/hierarchies/models/definition`),helpUrl:"https://codeontime.com/roadmap/v9",location:"right",dragDrop:"appstudio"}),lt("models")}).catch(n=>w(n)):c({event:{type:"studioactionmodels.app"}}),!1)).on("studioactionpages.app",()=>(i?p().then(()=>{$app.touch.propGrid("show",{instance:"studio.pages",text:"Pages",icon:"material-icon-menu-book",nodes:st(`/v2/studio/hierarchies/pages/definition`),helpUrl:"https://codeontime.com/roadmap/v9",location:"right",dragDrop:"appstudio"}),lt("pages")}).catch(n=>w(n)):c({event:{type:"studioactionpages.app"}}),!1)).on("studioaction222publish.app",n=>(i?t.touch.show({text:"Publish",text2:"App Studio",values:{Frontend:"production"},topics:[{text:"Options",wrap:!1,questions:[{name:"OutputPath",placeholder:"An alternative location for the published files"},{name:"Frontend",required:!0,items:{list:[{value:"development",text:"Development"},{value:"production",text:"Production"}]},options:{lookup:{openOnTap:!0,nullValue:!1}}}]}],options:{materialIcon:"publish",modal:{fitContent:!0,max:"xs",always:!0},contentStub:!1,discardChangesPrompt:!1},submitText:"Publish"}).then(n=>{f("log"),p().then(()=>t.studio.tools.sync.run({metadata:!!n.SchemaChanged})).then(nt).catch(ut)}).fail(()=>{n.exitOnCancel&&y()}):c({event:{type:"studioactionpublish"}}),!1)).on("studioactionformtemplate.app",n=>{var t;if(i)n.notify?$app.touch.notify(n.notify):h({method:"trigger",event:{type:"studioactionformtemplate.app"}});else if(t=$app.touch.dataView(),t&&t.get_isForm()){var e=t._survey,f=t._controller,u="";e&&e.layout?(f=f.replace(/__search/,"._search"),u+=String.format("<!--\r\n\t~/js/surveys/{0}.html\r\n-->\r\n{1}",f,e.layout)):(f+="."+t._viewId,u+="\r\n<!--  "+$app.touch.toWidth(r.width)+" -->\r\n",u+=$app.touch.generateLayout(t,r.width),u+="\r\n",u=String.format("<!--\r\n\t~/views/{0}.html\r\n-->\r\n{1}",f,u.replace(/<span\s+class=\"app-control-inner\">([\s\S]+?)<\/span>/g,"$1").replace(/\n\s*>/g,">")));$app.saveFile(f+".html.txt",u)}else a({method:"trigger",event:{type:"studioactionformtemplate.app",data:{notify:"The top-level view is not a form."}}});return!1}).on("studioonstartdisabled.app",()=>(ot(),!1)).on("studioactiondevice.app",r=>{if(i){var f=$('[data-studio-action="device"]').addClass("app-selected"),e=t.clientRect(f),u=[];if(dt.forEach((n,t)=>{u.push({text:n.name,context:{device:n,exitStudio:r.exitStudio},icon:ai(n)?"check":null,callback:gi}),t||u.push({text:"RESTful API",callback:s,context:{action:"restful"}},{})}),n.listPopup({anchor:f,arrow:!1,x:e.left,y:e.top,items:u,fullscreen:!0}),!k)$(document).one("popupclosed.app",n=>{n.canceled&&!k&&y()})}else c({event:{type:"studioactiondevice.app",data:{exitStudio:!0}}});return!1}).on("studiofeature.app",()=>{var i=d[d._last],r="",n,t;return i&&(n=d[d._last].url,t=i.url.match(/id\.(\w+)$/),t&&(r="#"+t[1])),n="https://codeontime.com/roadmap/v9"+r,window.open(n,"_blank"),!1}).on("studioactionsync.app",n=>(i?t.touch.show({text:"Sync Design",text2:"App Studio",topics:[{wrap:!0,questions:[{text:!1,value:"<b>Integrate changes made by other developers in the project.<\/b><p><\/p>",readOnly:!0,htmlEncode:!1,options:{textStyle:"primary"}},{name:"SchemaChanged",text:!1,items:{style:"CheckBoxList",list:[{value:"SchemaChanged",text:"The database schema has changed recently."}]},options:{mergeWithPrevious:!0}}]}],options:{materialIcon:"sync",modal:{fitContent:!0,max:"xxs",always:!0},contentStub:!1,discardChangesPrompt:!1},submitText:"Synchronize"}).then(n=>{f("log"),p().then(()=>t.studio.tools.sync.run({metadata:!!n.SchemaChanged})).then(nt).catch(ut)}).fail(()=>{n.exitOnCancel&&y()}):c({event:{type:"studioactionsync.app",data:{exitOnCancel:!0}}}),!1)).on("studioactionrotate.app",()=>{if(i)h({method:"trigger",event:{type:"studioactionrotate.app"}});else{var n=nr(),t,u;r.width===n.width?(t=n.height,u=n.width):(t=n.width,u=n.height);tt({name:n.name,width:t,height:u})}return!1}).on("studioactionstartover.app",()=>(i?t.touch.show({text:"Reset Session",text2:"App Studio",topics:[{wrap:!0,questions:[{text:!1,value:"This will clear all your current settings, filters, and selections.<br/>The app design will remain the same.<br/><br/>Are you sure you want to continue?",readOnly:!0,htmlEncode:!1,options:{textStyle:"primary"}}]}],options:{materialIcon:"history",modal:{fitContent:!0,max:"xxs",always:!0},contentStub:!1,discardChangesPrompt:!1},submitText:"Yes",cancelText:"No"}).then(()=>{n.notify("Starting over now..."),setTimeout(()=>{try{oi(localStorage);oi(sessionStorage)}catch(n){}h({method:"reload"})},200)}):c({event:{type:"studioactionstartover.app"}}),!1)).on("vclick",".studio-skirt, .app-virtual-screen-bar",()=>(n.notify(!1),i&&rt(),!1));$(window).on("resize",function(){i&&rt()});$(document).on("treeview.app",r=>{var u,f,e;if(i){u=r.treeView;switch(u.eventName){case"iterate":u.result=ri({hypermedia:u.node.iterate,context:u.nodeData}).then(n=>Promise.resolve(n?.collection||[]));break;case"navigate":r.preventDefault();f=u.path.match(/^(.+?)\:\/\/(.+)$/);f&&(t.userVar("treeview.studio."+f[1],u.path),n.goBack(()=>$(document).trigger(`studioaction${f[1]}.app`)));break;case"get":r.preventDefault();u.nodeData&&(u.result=g({url:u.nodeData._links.self}));break;case"select":e=u.nodeData;e&&(v.data("inspected")?v.removeData("inspected"):h({method:"nodeChanged",nodeData:e}))}}}).on("propgrid.app",n=>{if(i)switch(n.propGrid.eventName){case"edit":n.propGrid.result=pi(n.propGrid,n.treeView);break;case"changed":wi(n.propGrid.target,n.propGrid.propMap);break;case"help":return yi(n.propGrid,n.treeView),!1;case"fetch":n.propGrid.result=Promise.all([ri({hypermedia:n.treeView.node?.get,context:n.treeView.nodeData}),bi(n.treeView.elem.find(".app-selected").length>1?null:n.treeView.nodeType)]).catch(w);break;case"hypermedia":n.propGrid.result=g(n.propGrid.eventArgs).then(t=>{if(n.propGrid.trigger!=="none"){var i=n.propGrid.trigger||ct();i!="none"&&f("trigger",i)}return t}).catch(w)}});window.addEventListener("message",function(s){var h=s.data.method,v,p,w,c,ut,et,st,ct,k,d,g,nt,lt,l,rt;if(h==="inspect")t.studio.getScript("~/js/studio/inspector.js").then(()=>t.studio.inspect(s.data.at.x,s.data.at.y)).catch(n=>a({method:"notify",message:at(n)}));else if(h==="explore")v=s.data.bounds,p=s.data.navigate,ht("show").data("inspected",!0).css({left:v.left,top:v.top,width:v.width,height:v.height}),p?(w=p.split(/^(.+?)\:\/\//),w&&(t.userVar("treeview.studio."+w[1],p),$(document).trigger(`studioaction${w[1]}.app`))):di(s.data.selector);else if(h==="started")e.addClass("studio-mode"),b.css("left",""),n.busy(!1),$(".studio-btn-inspect i").text("point_scan");else if(h==="enableVirtualDevice")r.isVirtual||(c=t.userVar("lastVirtualDevice"),c&&(c.autoRotate=!0),c&&c.width||(c={name:"Responsive",width:"auto",height:"auto"}),tt(c)),wt(),pt(),vt(),ft&&(ut=ft.event,ut&&a({method:"trigger",event:ut})),ft=null;else if(h==="hide")if(b&&b.remove(),b=null,e.removeClass("studio-mode"),yt(),et=$(".ui-popup-active,.ui-panel-open").find(".app-has-scrollbars"),et.length)et.trigger("focus");else{$(".ui-page-active").trigger("focus");try{st=window.history.state;st&&it&&st.url!==it.url&&(window.history.replaceState(it,null),it=null)}catch(bt){}}else h==="exit"?i?y():ot():h==="trigger"?(ct=$.Event(s.data.event.type,s.data.event.data),$(this.document).trigger(ct)):h==="notify"?n.notify(s.data.message):h==="reload"?location.replace(location.pathname):h==="changeDevice"?(tt(s.data.device),s.data.exitStudio&&a({method:"exit"})):h==="virtualDeviceChanged"?($('[data-studio-action="device"] .studio-btn-label').html(s.data.options.text),o=s.data.options.screen,k=$(".studio-skirt-top"),k.length||(k=u("studio-skirt studio-skirt-top").appendTo(e)),k.css({left:0,top:0,height:o.top,right:0}),d=$(".studio-skirt-bottom"),d.length||(d=u("studio-skirt studio-skirt-bottom").appendTo(e)),d.css({left:0,bottom:0,height:o.bottom,right:0}),g=$(".studio-skirt-left"),g.length||(g=u("studio-skirt studio-skirt-left").appendTo(e)),g.css({left:0,bottom:0,width:o.left,top:0}),nt=$(".studio-skirt-right"),nt.length||(nt=u("studio-skirt studio-skirt-right").appendTo(e)),nt.css({right:0,bottom:0,width:o.right,top:0}),f("reposition")):h==="studioToolsChanged"?$('[data-studio-action="rotate"]').toggleClass("studio-btn-hidden",!s.data.tools.rotate):h==="alterUI"?(lt=s.data,i||s.data.scripts.forEach(n=>{try{t.eval(n,s.data.context)}catch(i){a({method:"notify",message:i.message})}})):h=="shield"?i&&f(s.data.args.method,s.data.args.options):h=="nodeChanged"?i||ki(s.data.nodeData):h==="marker"&&i&&(l=s.data.bounds,rt=ht(),rt.data("inspected")?rt.removeData("inspected"):l?ht("show").css({left:l.left,top:l.top,width:l.width,height:l.height}):rt.hide())});i||n.activePage().length||(t.studio._started=!1);t.studio.shield=f;t.studio.state=function(n){if(arguments.length)n==null?localStorage.removeItem("studio.state"):localStorage.setItem("studio.state",JSON.stringify(n));else return n=localStorage.getItem("studio.state"),n!=null?JSON.parse(n):{}};$(document).on("invokegetpage.app",i=>{var f=i.invoke.params.controller.match(/^data\:application\/json\;base64\s(.+?)$/),u,r;if(f)return u=n.dataView()._survey.context.target,u._context=n.propGrid.data,r=JSON.parse(atob(f[1])),r.hypermedia&&(r.hypermedia.match(/\$\{/)&&(r.hypermedia=t.eval(r.hypermedia,u)),r.hypermedia=`projects >> ${t.id} >> ${r.hypermedia}`),r?.query?.filter&&(r.query.filter=t.eval(r.query.filter,u)),delete u._context,r.cache=!0,g(r).then(n=>{r.processor&&t.eval(r.processor,n);var u=t.studio.utils.resourceToViewPage(n,r);i.invoke.params.controller=u.Controller;i.invoke.success(u)}).catch(w),!1}).on("invokegetpagelist.app",()=>{}).on("pointerdown mousedown touchstart","[data-studio-link]",function(){var n=$(this).attr("data-studio-link");if(n&&n.match(/^http/))return window.open(n,"_blank"),!1})})()