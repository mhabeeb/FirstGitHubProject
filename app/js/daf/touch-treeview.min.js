/*!
* Touch UI - Tree View
* Copyright 2023-2024 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function tt(n,t,i){var o,r,u,f,e,s,h;for(o in n){if(r=n[o]||{},r.name=o,t&&(r.parent=t),u=r.accept,u&&(u instanceof Array||(u=u.toString().split(/\s+/g)),f=[],u.forEach(n=>{var t=n.match(/^(\w+(\:[\w\-]+)?)$/);t&&t[2]?f.push(n):f.push(n+":move",n+":copy")}),r.accept=f,f.forEach(n=>{var t=n.match(/^(.+?\:(move|copy)-if-same-)(.+)$/);t&&(n=t[1]);i.accept.includes(n)||i.accept.push(n)})),e=r.actions,e)for(s in e)h=e[s],typeof h=="string"&&(e[s]={execute:h});r.nodes&&tt(r.nodes,r,i)}}function r(t,i){var r=n.treeView._navigating;return arguments.length&&r!=t&&(n.treeView._navigating=t,n.activePage(".app-treeview").css("visibility",t&&i!=!1?"hidden":"")),r}function c(u,f){var e,s,o,a,v,k,h,l,p,w,b;if(typeof f=="string"){if(s=f.match(/^(.+?)\:\/\/(.+)$/),s)if(o=n.treeView.context(u),o.hierarchy.endsWith("."+s[1]))f=s[2];else{if(r(!1),o.eventName="navigate",o.path=f,a=$.Event("treeview.app",{treeView:o}),$(document).trigger(a),a.isDefaultPrevented())return;n.notify({text:`Unable to navigate to ${f}`,duration:"long"})}if(f=f.split(/\//g),f[0].match(/^\./)&&f.length===1){r(!1);n.propGrid.select(f[0].substring(1));return}if(f.forEach((n,t)=>{n.match(/^\./)||(n=n.toLowerCase()),f[t]=decodeURIComponent(n)}),f[0]===".")e=u.find(".app-selected"),f.splice(0,1,e.data("nodeId"));else if(f[0]==="..")for(e=u.find(".app-selected");f.length&&f[0]=="..";)f.splice(0,1,e.data("nodeId")),e=e.parent().closest("li")}f.length&&(e||u.find(">li").each(function(){var n=$(this),t=n.data("nodeId");if(t===f[0])return e=n,!1}),e?(f._cleared||(e.closest(".app-treeview").find(".app-selected").removeClass("app-selected"),f._cleared=!0),f.splice(0,1),v=!0,f.length===1&&f[0].match(/^\./)?(k=n.dataView(),t.userVar(`${k._survey.context.instance}.navigate`,f[0])):f.length&&(v=!1,e.is(".app-collapsed")&&e.find(">.app-node>.app-toggle").trigger("vclick"),c(e.find("ul"),f)),v&&(h=e.data("navigating",!0).find(">.app-node").trigger("vclick"),e.removeData("navigating"),l=h.find(".app-anchor")[0],l&&(n.busy()||r()?l.scrollIntoView({block:y("center"),behavior:"instant"}):(p=i(h.closest(".app-treeview")),w=i(h),w.top>p.top&&w.bottom<p.bottom||n.pageShown(()=>{setTimeout(()=>{l.scrollIntoView({block:y("center"),behavior:"smooth"})})}))),r(!1))):(b=u.find(">.app-loading"),b.length?b.data("navigate",f):r(!1)))}function it(n,t){var i=null;return n&&(n.name==t&&(i=n),i||(n.nodes&&(i=n.nodes[t]),(!i||i.clone)&&(i=it(n.parent,t)))),i}function rt(n){var t={};for(var i in n)t[i]=n[i];return t}function o(i,r,u,f){var wt=i.closest(".app-treeview"),bt=wt.data("dragDrop"),w=null,y,vt,h,b,nt,c,tt,st,et,a,v,ht,ct,l,d,yt,lt,at,g,p,ot;for(y in r){if(vt=r[y],h=rt(vt),h.clone&&(b=it(h.parent,h.clone),b)){b=rt(b);for(nt in h)nt.match(/^(clone|name|parent)$/)||(b[nt]=h[nt]);h=b}c=u;try{c||h.iterate||!h.inherit||(w||(w=i.closest("li").data(),c={},c[w.nodeName]=w.nodeData,w=c),c=w);tt=t.eval(h.text,c)||t.prettyText(y,!0);st=h.id?t.eval(h.id,c):tt;(h.text==null||h.text===tt)&&(st=y);et=h.type;a=gt().attr({"data-type":et&&et.match(/\s+/)?"":et}).data({nodeName:y,nodeTemplate:h,nodeData:u,nodeId:encodeURIComponent(st.toLowerCase())});y==="_root"&&a.addClass("app-root");f?a.insertBefore(f):a.appendTo(i);v=e("app-node").appendTo(a);bt&&v.attr("data-draggable","treeview");e("app-anchor").appendTo(v);ht=e("app-text").appendTo(v).text(tt);h.textMuted&&(ct=t.eval(h.textMuted,c),ct!=null&&e("app-muted").appendTo(v).text(ct));l=h.icon;l&&(l=t.eval(l,c),typeof l=="string"&&(d=l.match(/^material-icon-(.+)$/),d?k("i","app-icon material-icon").text(d[1].replace(/\W/i,"_")).appendTo(ht):(l.match(/^[\w\-_]+$/)||(l=""),d=l.match(/^material-symbol-(.+)$/),d?e("symbol").text(d[1].replace(/\-/g,"_")).appendTo(k("i","app-icon material-symbol "+l).appendTo(v)):k("i","app-icon "+l).appendTo(v))));h.iterate&&u==null?(v.text("Loading..."),yt=a.addClass("app-loading").data(),yt.nodeId+="-loading",lt=i.closest("li"),(!lt.length||lt.is(".app-expanded"))&&ft(y,h,i,a)):(at=h.tooltip,typeof at=="string"&&ht.attr("data-title",t.eval(at,c)),g=h.nodes,p=h.terminal,typeof p=="string"&&(p=t.eval(p,c)),g?p&&(g=null):p==null||p||(g=[h]),g&&(a.addClass(h.expanded?"app-expanded":"app-collapsed"),e("app-toggle").appendTo(v),ot=s().appendTo(a),o(ot,g),ot.find("> li.app-loading").length&&ot.find("> li:not(.app-loading)").addClass("app-loading-wait")))}catch(pt){n.notify({text:pt.message+": \n"+JSON.stringify(ut(h),null,2),duration:"long"});throw pt;}}}function ut(n){if(n.parent=null,n.nodes)for(var t in n.nodes)ut(n.nodes[t]);return n}function ft(t,u,e,s){var l=f("iterate",s),h;if(l.isDefaultPrevented()){s.remove();return}h=l.treeView.result;h instanceof Promise||(Array.isArray(h)||(h=[h]),h=Promise.resolve(h));h.then(n=>{var g={},w,y,l,nt,h,a,b,k,v,d,p;if(g[t]=u,n.forEach(n=>{o(e,g,n,s)}),e.find("> li.app-loading-wait").removeClass("app-loading-wait"),w=s.data("navigate"),s.remove(),n.length||e.find(".app-node").length||e.closest("li").removeClass("app-expanded").find(".app-node .app-toggle").remove(),w)c(e,w);else{if(y=e.parent(),l=y.data("pendingResult"),l)if(y.removeData("pendingResult"),l.navigating&&r(!1,!0),e.prev("ul").remove(),nt=e.closest(".app-treeview"),h=l.selectIdentifiers,h)if(h.forEach((n,t)=>h[t]=n.toLowerCase()),e.find("li").each(function(){var n=$(this),t=h.indexOf(n.data().nodeId);t>=0&&(n.addClass("app-selected"),h.splice(t,1))}),a=e.find(".app-selected").first(),a.length)b=i(nt),k=i(a),(b.top>k.top||b.bottom<k.bottom)&&a[0].scrollIntoView({block:"nearest",behavior:"instant"}),f("select",a);else if(h.length){v={};h.forEach(n=>{var t=n.split(/\//g),r,i;t.length>1&&(r=t[0],i=v[r],i||(i=v[r]=[]),t.splice(0,1),i.push(t.join("/")))});for(d in v)p=e.find("li.app-collapsed").filter(function(){return $(this).data("nodeId")==d}),p.length&&(p.data("pendingResult",{success:!0,navigating:!0,selectIdentifiers:v[d]}),r(!0,!0),p.find("> .app-node .app-toggle").trigger("vclick"))}else f("select");else n.length||e.find("li").length||e.remove(),f("select");l&&y.is(".app-expanded")||yt(e.parent())}}).catch(t=>{n.notify({text:t.errors?t.errors[0].message:t.message,duration:"long"});throw t;})}function ni(n,t){n.nodeType=at(n.node,t);var i=t?._links?.self?.href,r=t?._links?.related?.href,u=[],e=[];n.elem.find("li:not(.app-loading)").each(function(){var f=$(this),o=f.data()?.nodeData?._links,n,t;o&&(n=o?.self?.href,t=o?.related?.href,n===i?e.push(f):(n&&(n===i||n===r)||t&&(t===i||t===r))&&u.push(f))});e.forEach(n=>d(n,t));u.forEach(n=>{var i=f("get",n),t=i.treeView.result;t instanceof Promise?t.then(t=>{d(n,t)}):d(n,t)})}function d(t,i){var e=t.data(),o={},f,r,c;o[e.nodeName]=e.nodeTemplate;var l=t.find(".app-selected"),u=t.find("> .app-node"),h=s();n.treeView.createNodes(h,o,i);f=u.data("draggable");r=h.children().insertAfter(t).toggleClass("app-selected",t.is(".app-selected"));f&&r.find("> .app-node").attr("data-draggable",f);r.data("self",i);l.length?(c=r.data("nodeData"),t.data("nodeData",c),r.find("> .app-node").insertAfter(u),r.remove(),u.remove()):t.remove()}function et(n){var t=n.find("> ul"),r,u,f;if(t.length&&(r=parseFloat(t.css("transition-duration"))*1e3,r)){if(r+=16,u=t.closest(".app-treeview"),u.data("animating"))return;u.data("animating",!0);f=i(t);f.height?(t.css("max-height",0),setTimeout(()=>{t.css("max-height",f.height),setTimeout(()=>{t.css("max-height",""),u.removeData("animating")},r)})):(t.css("display","block"),f=i(t),t.css("max-height",f.height),setTimeout(()=>{t.css("max-height",0),setTimeout(()=>{t.css({display:"","max-height":""}),u.removeData("animating")},r)}))}}function l(){var n=!0;return r()||(nt.blur(),n=nt.valid()),!n}function ot(n,t,i){Array.isArray(i)||(i=[i]);for(var r=0;r<i.length;r++)if(t.includes(n.nodeName+":"+i[r]))return!0;return!1}function st(i,r){var v,e,f,c,o,y,nt;if(r||(r=[]),v=i.elem.data("accept"),e=i.nodeElem,i.node){ot(i,v,["move","move-if-same-","move-if-descendant"])&&r.push({text:b.Cut,icon:"material-icon-content-cut",context:"cut",callback:g});ot(i,v,["copy","copy-if-same-"])&&r.push({text:b.Copy,icon:"material-icon-content-copy",context:"copy",callback:g});f=t.clipboard();typeof f=="object"&&(f=n.treeView.selectionToList(f),f.length&&e&&!e.is(".app-cut")&&(c=wt(e,f),(c.canCopy||c.canMove)&&r.push({text:b.Paste+(f.length>1?` (${f.length})`:""),icon:"material-icon-content-paste",context:c.canMove?"paste-move":"paste-copy",callback:g})));var p=e?e.data("self"):null,w=p?._links,k=i.node.actions||{},tt=r.length,h;for(o in k){var u=k[o]||{},d=u,l=u.execute?ti:null,s=u.body;if(u.selected!=null){if(h||(h=[],n.treeView.selectionToList(i.elem).forEach(n=>h.push(n.nodeData))),y=parseInt(u.selected),!isNaN(y)&&y!=h.length)continue;"body"in u&&!s?s=undefined:(s||(s={}),s.parameters={data:h})}!l&&w&&(nt=w[o],nt&&(l=a,d={treeView:i,hypermedia:o,resource:p,body:s,trigger:u.trigger}));l&&((r.length==tt||u.separator)&&r.push({}),r.push({text:u.text||t.prettyText(o,!0),icon:u.icon||kt[o],context:d,callback:l}))}}return r}function ti(i){var r=n.treeView.context();t.eval(i.execute+"\n",r.nodeData||{})}function ht(t){return new Promise(function(i,r){t&&n.notify({text:t,duration:"long"});r()})}function ct(){var r=n.dataView(),i=r?._survey?.context?.instance;i&&(t.userVar(`${i}.navigate`,"$identifier"),n.activePage().data("last-focused-field",null))}function a(i){var u=i.hypermedia,p=i?.resource?._links,c=i.treeView.elem,r,h,l,v,y;return!p||!p[u]?ht(`Hypermedia control "${u}" is not found in
${JSON.stringify(i.resource,null,4)}`):u=="remove"&&!i._confirmed?(r=n.treeView.selectionToList(c),h=5,r.forEach((n,t)=>r[t]=n.nodeFriendlyPath),r.length>h&&(r[h]="+"+(r.length-h),r.splice(h+1)),t.confirm(w.Data.NoteDeleteConfirm+`

${r.join(", ")}`).then(()=>{i._confirmed=!0,a(i)})):(l=i.resource._links[u],v={url:l},i.body&&(v.body=i.body),y=f("hypermedia",i.treeView.nodeElem,v,i.trigger),y.result)?y.result.then(n=>{var t=n?.result,f,h;if(!t)switch(u){case"create":if(f=n?._links?.self?.href,f&&(h=f.split(/\//),t={success:!0,selectIdentifiers:[h[h.length-1]]},i.treeView.nodeElem.is(".app-root"))){ct();lt(c,t.selectIdentifiers[0]);return}break;case"delete":t={success:!0,refreshParent:[l.href]}}if(t?.success){u.match(/^create(-.+)?$/)&&ct();var r=[],a=i.treeView.nodeElem,v=t.refreshParent,y=v?.length,p=t.refreshChildren,w=p?.length;(y||w)&&c.find("li:not(.app-loading)").each(function(){var n=$(this),t=n.data()?.nodeData?._links?.self?.href;y&&v.includes(t)?r.push(n.parent().closest("li")):w&&p.includes(t)&&r.push(n)});r.length||(t?.selectIdentifiers?.length?r.push(a):r.push(a.parent().closest("li")));c.find(".app-selected").removeClass("app-selected app-cut");r.length&&r[0].closest("li").length?r.forEach(n=>{var r=i.treeView.nodeElem.closest(n).length,f=r?t:{},u;n.data("pendingResult",f);n.find("ul:first li:first").length||(e("app-toggle").appendTo(n.addClass("app-collapsed").removeClass("app-expanded").find(">.app-node")),o(s().appendTo(n),n.data().nodeTemplate.nodes));u=n.find("> ul > .app-loading").length;n.is(".app-collapsed")&&r&&n.find("> .app-node .app-toggle").trigger("vclick");u||o(s().appendTo(n),n.data().nodeTemplate.nodes)}):(t.handled=!0,lt(i.treeView.elem,t?.selectIdentifiers?t?.selectIdentifiers[0]:null))}return n}):ht()}function lt(n,t){var i=n.data("nodes");o(s().appendTo(n.empty()),i,null);t!=null?(r(!0),c(n.find("ul"),t)):f("select")}function g(n){setTimeout(()=>{switch(n){case"cut":ii();break;case"copy":ri();break;case"paste-copy":v(null,null,"copy");break;case"paste-move":v(null,null,"move")}})}function ii(){var i=n.treeView.context().elem;i.find(".app-cut").removeClass("app-cut");i.find(".app-selected").addClass("app-cut");t.clipboard(n.treeView.toSelection(i))}function ri(){var i=n.treeView.context().elem;i.find(".app-cut").removeClass("app-cut");t.clipboard(n.treeView.toSelection(i))}function v(i,r,u){var e=n.treeView.context(i),o,h,c,s;i||(i=e.nodeElem);o=i.data("self");o?(c=e.elem.find(".app-cut").removeClass("app-cut"),i||(i=e.nodeElem),u||(u=c.length?"move":"copy"),r||(r=n.treeView.selectionToList(t.clipboard()),u==="move"&&t.clipboard(null)),o._links[u]&&r.length?(s=[],r.length>1?r.forEach(n=>s.push(n.nodeData)):s=r[0].nodeData,a({treeView:e,selection:r,hypermedia:u,resource:o,body:{parameters:{data:s}}})):n.notify(`${u} ${r[0].nodeText}${r.length>1?" +"+(r.length-1).toString():""} to ${i.find("> .app-node .app-text").text()}`)):(h=f("select",i),h.result&&h.result.then(()=>v(i,r,u)))}function f(i,r,u,f){var e=n.treeView.context(r),o,s;return(e.eventName=i,e.eventArgs=u,e.trigger=f,o=$.Event("treeview.app",{treeView:e}),i==="iterate"&&e.node.when&&(s=t.eval(e.node.when,e.nodeData),!s))?(o.preventDefault(),o):($(document).trigger(o),i==="select"&&(e.elem.data("trackSelection")&&e.nodePath!=="_root"&&t.userVar("treeview."+e.hierarchy,e.nodePath),o.result&&o.result.then(n=>e.nodeElem.data("self",Array.isArray(n)?n[0]:n))),o)}function at(n,i){var r=n?.typeAlt||n?.type;return r&&r.match(/\s/)&&(r=i?t.eval(r,i):null),r}function vt(n){var t=n.nodeElem.closest("li"),r=t.data("self"),i;if(r==null&&(n.node.get||n.node.iterate))return i=f("select",t),i.result}function yt(n){var u,t;if(!r()){var o=i(n),s=n.closest(".app-treeview"),f=i(s),e=n.find("> ul"),h=i(e);h.bottom>f.bottom?(u="start",t=n,o.height<f.height&&(t=e,u="end"),t.length&&t[0].scrollIntoView({block:y(u),behavior:"smooth"})):et(n)}}function y(n){return t.dragMan.active()?"nearest":n}function pt(n,t){typeof t=="string"&&(n=n.closest(".app-treeview"),t=t.split("/"));n=n.find("> ul > li");var i=null;return n.each(function(){var n=$(this);if(n.data().nodeId===t[0])return i=n,!1}),i&&(t.splice(0,1),t.length&&(i=pt(i,t))),i}function wt(n,t,i,r){var s=!i,h=i,a=!0,o,y;r||(r=pt(n,t[0].nodePath),s=n.closest(".app-treeview").find(".app-cut").length>0,h=!s,a=!1,r||(r=$(r)));var p=n.data(),u=p.nodeTemplate.accept||[],c=!1,v=!1,w=t[0],f=w.nodeName,e=f+":move-if-same-",l=!1;return u.every(t=>(t.startsWith(e)&&(l=bt(n,r,t.substring(e.length))),!l)),e=f+":copy-if-same-",o=!1,u.every(t=>(t.startsWith(e)&&(o=bt(n,r,t.substring(e.length))),!o)),y=u.includes(f+":move-if-descendent")&&r.closest(n).length>0,s&&(u.includes(f+":move")||l||y)&&(c=!0),!c&&a&&(h=!0),h&&(u.includes(f+":copy")||o)&&(v=!0),{canMove:c,canCopy:v}}function bt(n,t,i){var f=!1,r,u;if(i==="parent")f=n.parent().is(t.parent());else{for(r=n,u=t;r.is("li")&&r.data("nodeName")!=i;)r=r.parent().parent();while(u.is("li")&&u.data("nodeName")!=i)u=u.parent().parent();r.is(u)&&(f=!0)}return f}var t=$app,nt=t.input,n=t.touch,ui=$(document),kt={create:"material-icon-add","delete":"material-icon-delete",rename:"material-icon-drive_file_rename_outline"},w=Web.DataViewResources,b=w.Editor,fi=w.Data.BooleanDefaultItems,i=t.clientRect,u=t.html,ei=u.tag,oi=u.div,si=u.span,k=u.$tag,hi=u.$p,h=u.$div,e=u.$span,ci=u.$a,dt=u.$i,gt=u.$li,s=u.$ul,p;n.treeView=function(i,u,f){var l,e,a,v,y;(!f||(n.treeView.ready=!0,f(),i))&&(typeof i!="string"&&(u=i,i="show"),l=u.nodes,l instanceof Promise?l.then(t=>{u.nodes=t.nodes||{},n.treeView(i,u)}):(e=u.treeView,a=u.trackSelection,e?(l=u.nodes||e.data("nodes"),o(s().appendTo(e.empty()),l,null)):(v={accept:[]},tt(l,null,v),e=h("app-treeview app-has-scrollbars").attr({"data-hierarchy":u.type,tabindex:-1}).data({nodes:l,trackSelection:a,multiSelect:u.multiSelect,dragDrop:u.dragDrop,accept:v.accept}),o(s().appendTo(e),l,null),u.container&&e.appendTo(u.container),u.before&&e.insertBefore(u.before),u.after&&e.insertAfter(u.after)),e.toggleClass("app-treeview-noicons",u.icons===!1),y=u.path||(a?t.userVar("treeview."+u.type):null),y&&(r(!0),c(e.find("ul"),y))))};$(document).on("vclick",".app-toggle",n=>{var t,i;return l()?!1:(t=$(n.target).closest("li"),t.is(".app-expanded")?(t.removeClass("app-expanded").addClass("app-collapsed"),et(t)):(t.removeClass("app-collapsed").addClass("app-expanded"),i=!0,t.find("> ul > li.app-loading").each(function(){var n=$(this),t=n.data();ft(t.nodeName,t.nodeTemplate,n.parent(),n);i=!1}),i&&yt(t)),!1)}).on("vclick",".app-treeview li span",t=>{var h,v,o,it,u,p,b,ut,ft,g,a,nt,tt;if(l()||(h=$(t.target),u=h.closest("li"),u.is(".app-loading")))return!1;if(!h.is(".app-toggle")&&n.dblClick($(h)))return u.find("> .app-node .app-toggle").trigger("vclick"),!1;if((v=h.closest(".app-treeview"),o=v.find(".app-selected"),t.isDefaultPrevented()||u.is(".app-selected")&&o.length===1&&!t.ctrlKey)||(it=f("beforeselect",u),it.isDefaultPrevented()))return!1;if(u=h.closest("li"),o.length&&v.data("multiSelect")){var et=u.data(),rt=o.first(),w=rt.data();if(et.nodeName===w.nodeName&&w.type){if(t.ctrlKey)u.toggleClass("app-selected",!u.is(".app-selected")),p=!0;else if(t.shiftKey){for(var ot=o.last(),k=v.find(`li[data-type="${w.type}"]:not(.app-loading)`).filter(":visible"),s=-1,c=-1,d=-1,e=0;e<k.length;)b=k[e],s===-1&&rt.is(b)&&(s=e),c===-1&&u.is(b)&&(c=e),d===-1&&ot.is(b)&&(d=e),e++;for(c<s&&(s=d),o.removeClass("app-selected"),ut=s<c?s:c,ft=c>s?c:s,e=ut;e<=ft;e++)$(k[e]).addClass("app-selected");p=!0}}else o.length===1&&!w.type&&u.is(".app-selected")&&t.ctrlKey&&(u.removeClass("app-selected"),p=!0)}return p||(o.removeClass("app-selected"),u.addClass("app-selected")),g=h.closest(".app-node"),a=null,r()||u.data("navigating")||(nt=i(g),tt=i(u.closest(".app-treeview")),nt.bottom>tt.bottom?a="end":nt.top<tt.top&&(a="start")),a&&g[0].scrollIntoView({block:y(a),behavior:"smooth"}),setTimeout(f,a?96:0,"select",u),!1}).on("vclick","[data-studio-link]",n=>{var u,i;if(l())return!1;if(u=$(n.target),i=u.closest("[data-studio-link]").attr("data-studio-link"),i){var f=u.closest(".app-propgrid"),o=f.find("[data-hierarchy]"),e=f.find(".app-selected").data("nodeData");e&&(i=t.eval(i,e));r(!0,!i.match(/^\./));c(o.find(">ul"),i)}return!1}).on("contextmenu taphold.app",".app-treeview",t=>{var r,i,u,e,f,o;return l()?!1:(r=n.treeView.context($(t.target)),i=$(t.target).closest(".app-node"),i.length||(i=r.elem.find(".app-root .app-node"),r=n.treeView.context(i)),u=i.parent(),r.elem.data("trackSelection")&&(u.is(".app-root")||r.node&&(!u.length||u.is(".app-selected"))?(e=vt(r),e?.then?e.then(()=>i.trigger("contextmenu")):(f=[],o=n.lastTouch(),st(r,f),f.length?n.listPopup({x:o.x,y:o.y,items:f,arrow:!1}):r.elem.focus())):i.length&&(i.trigger("vclick"),n.idle(()=>i.trigger("contextmenu")))),t.type==="contextmenu"?!1:void 0)});n.treeView.data=function(t){var i;return t?Array.isArray(t)||(t=t.split(/\s*,\s*/g)):i={},n.activePage(".app-treeview .app-selected:first .app-node").parents("li").each(function(){var r=$(this),n=r.attr("data-type"),u=r.data("nodeData");if(t){if(t.forEach(t=>{t===n&&(i=u)}),i)return!1}else n&&(i[n]=u||{})}),i};n.treeView.toSelection=function(t){var i={},r=t.data("hierarchy");return t.find(".app-selected").each(function(){for(var t=$(this),u={hierarchy:r,node:t.data("nodeTemplate"),nodeName:t.data("nodeName"),nodePath:n.treeView.toPath(t),nodeFriendlyPath:n.treeView.toPath(t,!0),nodeText:t.find(" > .app-node .app-text").text(),nodeIcon:t.find("i")[0]?.outerHTML};t.length&&!u.nodeData;)u.nodeData=t.data("nodeData"),t=t.parent().closest("li");i[`${r}://${u.nodePath}`]=u}),i};n.treeView.selectionToList=function(t){var i,r;t instanceof jQuery&&(t=n.treeView.toSelection(t));i=[];for(r in t)i.push(t[r]);return i};n.treeView.toPath=function(n,t){for(var i=[];n.length;)i.splice(0,0,n.is(".app-loading")?"*":t?n.find(">.app-node .app-text").text():n.data("nodeId")),n=n.parent().closest("li");return i.join("/")};n.treeView.context=function(t){t?t.is(".app-treeview")?t=t.find(".app-selected").first():t.is("li")||(t=t.closest(".app-node").parent()):t=n.activePage(".app-treeview .app-selected").first();for(var u=t.length?t.closest(".app-treeview"):n.activePage(".app-treeview"),e=u.attr("data-hierarchy"),o=t.data("nodeName"),f=t.data("nodeTemplate"),i,r=t;r.length&&!i;)i=r.data("nodeData"),r=r.parent().closest("li");return{hierarchy:e,elem:u,node:f,nodeName:o,nodePath:n.treeView.toPath(t),nodeData:i,nodeElem:t,nodeType:at(f,i)}};n.treeView.rename=function(t){var i=n.treeView.context();return a({treeView:i,hypermedia:"rename",resource:i.nodeElem.data("self"),body:{parameters:{newIdentifier:t}}})};n.treeView.actions=st;n.treeView.createNodes=o;n.treeView.replaceNode=ni;n.treeView.ensureNodeSelf=vt;p=t.dragMan.treeview={options:{taphold:function(n){return n.touch},immediate:!1},start:function(n){var t=this._target=n.target;n.touch?(n.taphold=!0,n.dir="horizontal"):(n.dir="all",n.sensitivity=3)},move:function(r){var u=this,o=u._target,s=u._treeView,h,l,v;if(!r.touch){if(!u._treeView){s=u._treeView=o.closest(".app-treeview").addClass("app-dragging");h=u._targetItem=o.parent();h.is(".app-selected")||o.trigger("vclick");o.addClass("app-dragging");u._data=h.data();rect=u._rect=i(s);u._glassPane(s);u._scrollBy=Math.ceil(i(h).height);var c=u._selection=n.treeView.selectionToList(s),w=u._dropHint=e("app-treeview-drop-hint").appendTo("body"),f=e("app-node").appendTo(w),y=c[0].nodeText;c.length>1&&(y+=` +${c.length-1}`);e("app-text").text(y).appendTo(f);l=c[0].nodeIcon;l&&$(l).appendTo(f);dt("app-drop-mode material-icon").appendTo(f)}if(u._toggleTimeout&&(clearTimeout(u._toggleTimeout),u._toggleTimeout=null),u._dropHint.css("transform",`translate3d(${r.x}px,${r.y}px,0)`),u._lastX!=r.x||u._lastY!=r.y||u._lastCtrlKey!=r.ctrlKey){u._lastX=r.x;u._lastY=r.y;u._lastCtrlKey=r.ctrlKey;var a=t.elementAt(r),f=a.closest(".app-node"),p=f.parent();f.length?(a.is(".app-toggle")?u._toggleTimeout=setTimeout(()=>a.trigger("vclick"),500):p.is(".app-selected")?u._dropNode():(v=wt(p,u._selection,r.ctrlKey,u._targetItem),v.canCopy?u._dropNode(f,"copy"):v.canMove?u._dropNode(f,"move"):u._dropNode()),f.is(u._lastDropNode)||u._dropNode()):u._dropNode()}u._resetTimeouts();u._startScrollTimeout=setTimeout(u._autoScroll,500)}},cancel:function(){var n=this;n._resetTimeouts();n._dropNode();n._target.removeClass("app-dragging");delete n._target;n._treeView&&(n._treeView.removeClass("app-dragging app-last-drop-move app-last-drop-copy"),n._treeView=null,n._selection=null,n._dropType=null,n._lastX=null,n._lastY=null,n._lastCtrlKey=null,n._dropHint.remove(),n._dropHint=null,n._targetItem=null);n._glassPane()},end:function(){var n=this,t=n._lastDropNode,r=n._selection,i=n._dropType;t&&i&&setTimeout(v,0,t.parent(),r,i);n.cancel()},_dropNode:function(n,t){var i=p,r=i._lastDropNode,u;r&&(n&&n.is(r)?r.removeClass(t==="move"?"app-drop-copy":"app-drop-move"):r.removeClass("app-drop-copy app-drop-move"),i._lastDropNode=null,u=!0);i._dropType=null;i._dropHint&&i._dropHint.toggleClass("app-drop-copy",t==="copy");arguments.length&&(i._lastDropNode=n.addClass("app-drop-"+t),i._dropType=t,clearTimeout(i._clearLastDropTimeout),i._cleareLastDrop(),u=!1,i._treeView.addClass("app-last-drop-"+t));u&&(clearTimeout(i._clearLastDropTimeout),i._clearLastDropTimeout=setTimeout(i._cleareLastDrop,96))},_cleareLastDrop:function(){var n=p._treeView;n&&n.removeClass("app-last-drop-copy app-last-drop-move")},_resetTimeouts:function(){var n=this;n._startScrollTimeout&&(clearTimeout(n._startScrollTimeout),n._startScrollTimeout=null);n._scrollTimeout&&(clearTimeout(n._scrollTimeout),n._scrollTimeout=null)},_autoScroll:function(n,t){var u;let i=p,a=i._treeView,r=i._rect;if(clearTimeout(i._scrollTimeout),i._scrollTimeout=null,a){u=a[0];let s=u.scrollTop,h=u.scrollLeft,v=u.scrollWidth,y=u.scrollHeight;if(arguments.length)u.scrollBy({left:n==null?0:n,top:t==null?0:t,behavior:"instant"}),setTimeout(i._autoScroll,48);else{var c,f,e=i._scrollBy,l=e,o,w=i._lastX>=r.left&&i._lastX<=r.right,b=i._lastY>=r.top&&i._lastY<=r.bottom;i._lastX<r.left+l&&b?h&&(c=-Math.min(h,e),o="left"):i._lastX>r.right-l&&b&&h+r.width-1<v&&(c=Math.min(v-(h+r.width-1),e),o="right");i._lastY<r.top+l&&w?s&&(f=-Math.min(s,e),o="up"):i._lastY>r.bottom-l&&w&&s+r.height-1<=y&&(f=Math.min(y-(s+r.height-1),e),f<1&&(f=e),o="down");c!=null||f!=null?(i._cleareLastDrop(),i._autoScroll(c,f),i._scrollingState(o)):i._scrollingState()}}},_scrollingState:function(n){this._panes.forEach((t,i)=>t.toggleClass("app-scroll-auto",i===0&&n==="up"||i===1&&n==="right"||i===2&&n==="down"||i===3&&n==="left"));this._treeView.toggleClass("app-scroll-auto",!!n)},_glassPane:function(n){var f=this,r=f._panes,t,u;r||(r=f._panes=[h("app-treeview-glass-pane"),h("app-treeview-glass-pane"),h("app-treeview-glass-pane"),h("app-treeview-glass-pane")]);n?(t=i(n),u=$("body"),r[0].css({left:0,top:0,width:"100%",height:t.top}).appendTo(u),r[1].css({left:t.right,top:t.top,width:screen.width-t.right+1,height:t.height}).appendTo(u),r[2].css({left:0,top:t.bottom,width:"100%",height:screen.height-t.bottom+1}).appendTo(u),r[3].css({left:0,top:t.top,width:t.left+4,height:t.height}).appendTo(u)):(r[0].remove(),r[1].remove(),r[2].remove(),r[3].remove())}}})()